# This file was auto-generated by the Firebase CLI
# https://github.com/firebase/firebase-tools

name: Deploy to Firebase Hosting on merge
"on":
  push:
    branches:
      - main
env:
  apiUrl: ${{ secrets.APIURL }}
  firebaseConfig: ${{ secrets.FIREBASECONFIG }}
  squareBasePath: ${{ secrets.SQUAREBASEPATH }}
  squareScopes: ${{ secrets.SQUARESCOPES }}
  SQ_APPLICATION_ID: ${{ secrets.SQ_APPLICATION_ID }}
  SQ_APPLICATION_SECRET: ${{ secrets.SQ_APPLICATION_SECRET }}
  SQ_ENVIRONMENT: ${{ secrets.SQ_ENVIRONMENT }}
  spacesConfig: ${{ secrets.SPACESCONFIG }}

jobs:
  build_and_deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - run: "yarn && cat webapp/src/environments/environment.ts && yarn config:prod && yarn build"
        working-directory: ./webapp
      - uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          entryPoint: "./webapp"
          repoToken: "${{ secrets.GITHUB_TOKEN }}"
          firebaseServiceAccount: "${{ secrets.FIREBASE_SERVICE_ACCOUNT_SQUARE_HOTEL }}"
          channelId: live
          projectId: square-hotel
